---
title: "Manipulação de Dados"
author: "Hugo Silva e Raquel Teixeira"
affiliation: 
    - Escola Nacional de Saúde Pública
date: today
date-format: long
lang: pt 
format:
  html:
    preview: false
    smooth-scroll: true
    embed-resources: true
    toc: true
    toc-location: left
    number-sections: true
    number-depth: 3
    code_download: true
    code-copy: true
    output-file: data_Manipulation.html
    output-dir: output/documents
execute:
  warning: false
  collapse: true
  message: false
  eval: true
  echo: true
title-block-style: default
theme: templata_ensp
editor: 
  markdown: 
    wrap: 72
project:
  output-dir: output/documents
---

# Carregar os pacotes necessários

```{r}
rm(list = ls(all.names = TRUE)) # limpa todos os objetos, incluindo os ocultos

required_packages <- c("janitor",
                       "tidyverse",
                       "rio",
                       "here",
                       "haven",
                       "data.table",
                       "lubridate",
                       "readxl"
                       )      

for (pkg in required_packages) {
  # install packages if not already present
  if (!pkg %in% rownames(installed.packages())) {
    install.packages(pkg)
  }
  
  # load packages to this current session 
  library(pkg, character.only = TRUE)
}
remove(required_packages)
remove(pkg)
```

# O Extinto ACES Maia/Valongo

O Extinto Agrupamento de Centros de Saúde do Grande Porto III – Maia/Valongo resultou da fusão dos anteriores ACeS da Maia e Valongo, conforme a Portaria nº 310/2012, de 10 de outubro.

Abrangia os concelhos da Maia e Valongo, com uma população de 229.164
residentes, distribuídos por 14 freguesias. Corresponde a uma área geográfica de 158,27 km2, com uma densidade populacional de 1447,93 hab./Km2.
O total de inscritos era de 217.516, dos quais 201.698 (92,7%) integrados em USF.

O ACeS Maia/Valongo integrava todas as unidades funcionais previstas no Decreto-Lei nº28/2008, de 22 de fevereiro.

Era composto por 30 unidades, distribuídas por 16 Unidades de Saúde Familiar, 3 Unidades de Cuidados de Saúde Personalizados, 5 Unidade de Cuidados na Comunidade, 1 Unidade de Recursos Assistenciais Partilhados, 1 Unidade de Saúde Pública, 1 Centro Diagnóstico Pneumológico (pólos em Valongo e Maia), e ainda 2 Serviços de Atendimento a Situações Urgentes (a funcionar em Ermesinde e Maia).

![Mapa da Área Metropolitana do
Porto](images/Mapa_AMP.jpg){fig-align="center"}

# Carregar a base de dados

```{r}

inquerito_AVC_2024 <- read_excel("datasets/inquerito_AVC_2024_processed.xlsx") |> 
  clean_names()

names(inquerito_AVC_2024)

```

```{r}
nrow(inquerito_AVC_2024)

```

# Explorar a base de dados

## Contagem de inquéritos por UCC pré e pós-intervenção

```{r}

summary_inquerito_by_ucc <- inquerito_AVC_2024 %>% 
  summarise(
    count = n(),
.by = c(altura_questionario, ucc), 
  ) %>%
  arrange(altura_questionario)

summary_inquerito_by_ucc

```

## Contagem de inquéritos respondidos por agrupamento pré e pós-intervenção

```{r}
summary_inquerito_by_agrupamento <- inquerito_AVC_2024 %>% 
  summarise(
    count = n(),
.by = c(altura_questionario, agrupamento_escolas)
  ) %>%
  arrange(altura_questionario)

summary_inquerito_by_agrupamento
```

# Graficamente

## Contagem de inquéritos respondidos por UCC pré e pós-intervenção

```{r}
summary_inquerito_by_ucc$altura_questionario <- factor(summary_inquerito_by_ucc$altura_questionario, 
                                                              levels = c("Pré-Intervenção", "Pós-intervenção")) 

grafico_alunos_por_ucc <- ggplot(data = summary_inquerito_by_ucc, aes(x = ucc,
                                                    y = count))+
  geom_bar(stat = "identity", fill = "#de3e3e") +
  labs(title = "Número de alunos por UCC",
       x = "UCC",
       y = "Alunos") +
  facet_wrap(~altura_questionario)+
  theme_minimal()
  
grafico_alunos_por_ucc 

```

## Contagem de inquéritos respondidos por agrupamento pré e pós-intervenção

```{r}
summary_inquerito_by_agrupamento$altura_questionario <- factor(summary_inquerito_by_agrupamento$altura_questionario, 
                                                              levels = c("Pré-Intervenção", "Pós-intervenção")) 

grafico_alunos_por_agrupamento <- ggplot(data = summary_inquerito_by_agrupamento, aes(x = agrupamento_escolas,
                                                    y = count))+
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Número de alunos por agrupamento",
       x = "Agrupamento",
       y = "Alunos") +
  facet_wrap(~ altura_questionario) +
  theme_minimal()
  
grafico_alunos_por_agrupamento  

```

## Distribuição dos inquéritos respondidos por sexo pré e pós-intervenção

```{r}
inquerito_AVC_2024$altura_questionario <- factor(inquerito_AVC_2024$altura_questionario, 
                                                              levels = c("Pré-Intervenção", "Pós-intervenção")) 

distribuicao_sexo <- ggplot(inquerito_AVC_2024, aes(x = sexo, fill = sexo)) +
  geom_bar() +
  labs(title = "Distribuição por Sexo",
       x = "Sexo",
       y = "Contagem") +
  scale_fill_manual(values = c("Masculino" = "#4287f5", "Feminino" = "#f542a7")) +
  facet_wrap(~ altura_questionario) +
  theme_minimal()

distribuicao_sexo

```
